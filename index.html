<!DOCTYPE html>
<html lang="en">
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type" />
    <title>App Title</title>
  </head>
  <body>
    <noscript>This page uses wasm and js. Please enable javascript.</noscript>
    <canvas id="canvas"></canvas>

    <!-- note that the script below must not be a module,
    so that it can reexport items into the global scope -->
    <script>
      function ovrt_sys_use_workaroud() {
        // workaroud to import module items
        console.trace("re-exporting event callbacks into the global scope");

        // events
        DevicePositionUpdate = window.ovrt_sys.DevicePositionUpdate;
        ReceiveMessage = window.ovrt_sys.ReceiveMessage;
        InteractionStateChanged = window.ovrt_sys.InteractionStateChanged;
        OverlayOpened = window.ovrt_sys.OverlayOpened;
        OverlayClosed = window.ovrt_sys.OverlayClosed;
        OverlayTransformChanged = window.ovrt_sys.OverlayTransformChanged;
        APIInit = window.ovrt_sys.APIInit;
        // callbacks
        SpawnOverlayOvrtSysCallback =
          window.ovrt_sys.SpawnOverlayOvrtSysCallback;
        GetWindowTitlesOvrtSysCallback =
          window.ovrt_sys.GetWindowTitlesOvrtSysCallback;
        GetMonitorCountOvrtSysCallback =
          window.ovrt_sys.GetMonitorCountOvrtSysCallback;
        GetOverlayTransformOvrtSysCallback =
          window.ovrt_sys.GetOverlayTransformOvrtSysCallback;
        GetOverlayTypeOvrtSysCallback =
          window.ovrt_sys.GetOverlayTypeOvrtSysCallback;
        GetOverlayBoundsOvrtSysCallback =
          window.ovrt_sys.GetOverlayBoundsOvrtSysCallback;
        GetFingerCurlsOvrtSysCallback =
          window.ovrt_sys.GetFingerCurlsOvrtSysCallback;
      }
    </script>
    <script type="module">
      import init, {
        // events
        DevicePositionUpdate,
        ReceiveMessage,
        InteractionStateChanged,
        OverlayOpened,
        OverlayClosed,
        OverlayTransformChanged,
        APIInit,
        // callbacks
        SpawnOverlayOvrtSysCallback,
        GetWindowTitlesOvrtSysCallback,
        GetMonitorCountOvrtSysCallback,
        GetOverlayTransformOvrtSysCallback,
        GetOverlayTypeOvrtSysCallback,
        GetOverlayBoundsOvrtSysCallback,
        GetFingerCurlsOvrtSysCallback,
        //
        wasm_main,
      } from "./pkg/ovrt_sys.js";

      export {
        // events
        DevicePositionUpdate,
        ReceiveMessage,
        InteractionStateChanged,
        OverlayOpened,
        OverlayClosed,
        OverlayTransformChanged,
        APIInit,
        // callbacks
        SpawnOverlayOvrtSysCallback,
        GetWindowTitlesOvrtSysCallback,
        GetMonitorCountOvrtSysCallback,
        GetOverlayTransformOvrtSysCallback,
        GetOverlayTypeOvrtSysCallback,
        GetOverlayBoundsOvrtSysCallback,
        GetFingerCurlsOvrtSysCallback,
      };

      async function run() {
        await init();

        console.trace("creating workaroud");

        // workaroud to export module items
        window.ovrt_sys = {
          // events
          DevicePositionUpdate: DevicePositionUpdate,
          ReceiveMessage: ReceiveMessage,
          InteractionStateChanged: InteractionStateChanged,
          OverlayOpened: OverlayOpened,
          OverlayClosed: OverlayClosed,
          OverlayTransformChanged: OverlayTransformChanged,
          APIInit: APIInit,
          // callbacks
          SpawnOverlayOvrtSysCallback: SpawnOverlayOvrtSysCallback,
          GetWindowTitlesOvrtSysCallback: GetWindowTitlesOvrtSysCallback,
          GetMonitorCountOvrtSysCallback: GetMonitorCountOvrtSysCallback,
          GetOverlayTransformOvrtSysCallback: GetOverlayTransformOvrtSysCallback,
          GetOverlayTypeOvrtSysCallback: GetOverlayTypeOvrtSysCallback,
          GetOverlayBoundsOvrtSysCallback: GetOverlayBoundsOvrtSysCallback,
          GetFingerCurlsOvrtSysCallback: GetFingerCurlsOvrtSysCallback,
        };
        ovrt_sys_use_workaroud();

        wasm_main();
      }
      run();
    </script>
  </body>
</html>
